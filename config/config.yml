###############################################################################
# üì¶ Roboflow Inference + Motion Highlight Settings
# Optimiert f√ºr Larvenbewegung / Vibrationssieb
###############################################################################

app:
  name: roboflow-counter
  data_dir: /opt/larvacounter/export   # Export-Ordner f√ºr Debug Frames, Logs

# ---------------------------------------------------------------------------
# üé• Kamera-Input (RTSP/RTSPS)
# ---------------------------------------------------------------------------
input:
  # RTSP(S) Kamera Quelle
  # Beispiel Unifi: rtsps://ip:7441/token?enableSrtp
  rtsp_url: "rtsps://192.168.1.1:7441/bMG3xZFjDVjXDCru?"

# ---------------------------------------------------------------------------
# üì° Video Output (RTSP zu MediaMTX / VLC etc.)
# ---------------------------------------------------------------------------
output:
  rtsp_url: "rtsp://127.0.0.1:8554/larvacounter"

# ---------------------------------------------------------------------------
# üß† Roboflow Model (f√ºr sp√§tere Einbindung)
# ---------------------------------------------------------------------------
model:
  id: "workspace/project:1"   # Aktuelles Training / Dataset Version

###############################################################################
# ‚ú® HIGHLIGHT OVERLAY SETTINGS
###############################################################################
background_darken: 0.40   # Abdunklungsfaktor (1.0 = kein Abdunkeln, 0.5 = 50% Helligkeit)

highlight:
  # Blendfaktor der Hervorhebung (0 = kein Overlay, 1 = volle St√§rke)
  # Bereich: 0.0 ‚Äì 1.0
  gain: 0.4


  # Weichzeichnen vor Bewegungserkennung (gl√§ttet Rauschen + Lichtflackern)
  gauss:
    # Kernelgr√∂√üe (ungerade Zahl, gr√∂√üer = weicher)
    # Bereich: 3,5,7,...31 (Empfehlung: 5‚Äì9)
    ksize: 20

    # Falls "auto": sigma wird passend zur Kernelgr√∂√üe berechnet
    # Bereich: "auto" oder float (z.B. 1.0‚Äì6.0)
    sigma: "auto"

###############################################################################
# üêõ MOTION DETECTION (EMA = Exponential Moving Average)
###############################################################################
motion:
  method: "ema"            # aktuell nur "ema", sp√§ter: background-model

  # Gl√§ttet zeitlich / reduziert Frame-Wobble
  # kleiner = tr√§ger (weniger Flackern), gr√∂√üer = empfindlicher
  # Bereich: 0.005 ‚Äì 0.20  (BSF optimal: 0.01 ‚Äì 0.05)
  ema_alpha: 0.05

  # Bewegungsschwelle pro Pixel (niedriger = empfindlicher)
  # Bereich: 5 ‚Äì 200  (BSF optimal: 50 ‚Äì 120)
  threshold: 150

###############################################################################
# üß´ REGION & GROWTH FILTER
# Gr√∂√üere zusammenh√§ngende Larvenbewegungen erkennen, Reflexionen filtern
###############################################################################
region:
  # Mindestgr√∂√üe eines Bewegungsclusters (Pixel)
  # Bereich: 10 ‚Äì 300 (BSF optimal: 50‚Äì150)
  min_pixels: 60

  # Wie viele Iterationen der Maske wachsen d√ºrfen (Fang Larvenk√∂rper)
  # Bereich: 0 ‚Äì 5
  grow_iters: 2

  # Kante-Schwelle (Sobel) f√ºr mask growth
  # niedriger = w√§chst mehr, h√∂her = stoppt an Kanten
  # Bereich: 5 ‚Äì 60 (BSF optimal: 15‚Äì30)
  edge_threshold: 20

  # Optional: grauwert-√Ñhnlichkeit beim Wachstum pr√ºfen (0 = aus)
  # Bereich: 0 ‚Äì 40 (BSF optimal: 0‚Äì15)
  gray_delta: 0

###############################################################################
# ‚öôÔ∏è RUNTIME SETTINGS
###############################################################################
runtime:
  # FPS Limit des Ausgabe-Streams
  # 0 = automatisch Kamera FPS
  fps: 0

  # Timeout f√ºrs √ñffnen des Kamera-Streams (ms)
  # Bereich: 2000 ‚Äì 20000 ms
  open_timeout_ms: 8000
